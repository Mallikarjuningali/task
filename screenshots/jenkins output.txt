Started by user mallu
Obtained Jenkinsfile from git https://github.com/Mallikarjuningali/task.git
[Pipeline] Start of Pipeline
[Pipeline] node
Running on Jenkins in /var/lib/jenkins/workspace/crud-deploy-pipeline
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Declarative: Checkout SCM)
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
No credentials specified
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/crud-deploy-pipeline/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/Mallikarjuningali/task.git # timeout=10
Fetching upstream changes from https://github.com/Mallikarjuningali/task.git
 > git --version # timeout=10
 > git --version # 'git version 2.43.0'
 > git fetch --tags --force --progress -- https://github.com/Mallikarjuningali/task.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/main^{commit} # timeout=10
Checking out Revision a8e8e62cbcdff9148ba75035d741c4bf5af4d5ba (refs/remotes/origin/main)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f a8e8e62cbcdff9148ba75035d741c4bf5af4d5ba # timeout=10
Commit message: "Delete mal"
 > git rev-list --no-walk a09cb4393f9739a506df6a58ce5c16138d369b0c # timeout=10
[Pipeline] }
[Pipeline] // stage
[Pipeline] withEnv
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] stage
[Pipeline] { (Checkout)
[Pipeline] checkout
Selected Git installation does not exist. Using Default
The recommended git tool is: NONE
No credentials specified
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/crud-deploy-pipeline/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/Mallikarjuningali/task.git # timeout=10
Fetching upstream changes from https://github.com/Mallikarjuningali/task.git
 > git --version # timeout=10
 > git --version # 'git version 2.43.0'
 > git fetch --tags --force --progress -- https://github.com/Mallikarjuningali/task.git +refs/heads/*:refs/remotes/origin/* # timeout=10
 > git rev-parse refs/remotes/origin/main^{commit} # timeout=10
Checking out Revision a8e8e62cbcdff9148ba75035d741c4bf5af4d5ba (refs/remotes/origin/main)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f a8e8e62cbcdff9148ba75035d741c4bf5af4d5ba # timeout=10
Commit message: "Delete mal"
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build Backend Image)
[Pipeline] sh
+ docker build -t mallikarjuningali/crud-dd-backend:latest -f Dockerfile.backend .
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon  59.54MB

Step 1/9 : FROM node:18-alpine
 ---> ee77c6cd7c18
Step 2/9 : WORKDIR /usr/src/app
 ---> Using cache
 ---> f1b2c385a69b
Step 3/9 : COPY backend/package*.json ./
 ---> Using cache
 ---> 51c161f751a4
Step 4/9 : RUN if [ -f package-lock.json ]; then npm ci --omit=dev; else npm install --omit=dev; fi
 ---> Using cache
 ---> aaf27813124a
Step 5/9 : COPY backend/ /usr/src/app/
 ---> 668789a8d402
Step 6/9 : ENV NODE_ENV=production
 ---> Running in 467f7c323614
 ---> Removed intermediate container 467f7c323614
 ---> a0ca99a407e0
Step 7/9 : ENV PORT=8080
 ---> Running in 8468d450b66f
 ---> Removed intermediate container 8468d450b66f
 ---> ba015d509a58
Step 8/9 : EXPOSE 8080
 ---> Running in 06b3745ef57c
 ---> Removed intermediate container 06b3745ef57c
 ---> 91e8fa4f5914
Step 9/9 : CMD ["node", "server.js"]
 ---> Running in 046a1a94a95f
 ---> Removed intermediate container 046a1a94a95f
 ---> 4dfb89135b12
Successfully built 4dfb89135b12
Successfully tagged mallikarjuningali/crud-dd-backend:latest
[Pipeline] sh
+ docker build -t mallikarjuningali/crud-dd-backend:37 -f Dockerfile.backend .
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon  59.54MB

Step 1/9 : FROM node:18-alpine
 ---> ee77c6cd7c18
Step 2/9 : WORKDIR /usr/src/app
 ---> Using cache
 ---> f1b2c385a69b
Step 3/9 : COPY backend/package*.json ./
 ---> Using cache
 ---> 51c161f751a4
Step 4/9 : RUN if [ -f package-lock.json ]; then npm ci --omit=dev; else npm install --omit=dev; fi
 ---> Using cache
 ---> aaf27813124a
Step 5/9 : COPY backend/ /usr/src/app/
 ---> Using cache
 ---> 668789a8d402
Step 6/9 : ENV NODE_ENV=production
 ---> Using cache
 ---> a0ca99a407e0
Step 7/9 : ENV PORT=8080
 ---> Using cache
 ---> ba015d509a58
Step 8/9 : EXPOSE 8080
 ---> Using cache
 ---> 91e8fa4f5914
Step 9/9 : CMD ["node", "server.js"]
 ---> Using cache
 ---> 4dfb89135b12
Successfully built 4dfb89135b12
Successfully tagged mallikarjuningali/crud-dd-backend:37
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build Frontend Image)
[Pipeline] sh
+ docker build -t mallikarjuningali/crud-dd-frontend:latest -f Dockerfile.frontend .
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon  59.54MB

Step 1/12 : FROM node:16 AS build
 ---> 1ddc7e4055fd
Step 2/12 : WORKDIR /usr/src/app
 ---> Using cache
 ---> bccdf6f0d1ed
Step 3/12 : COPY frontend/package*.json ./
 ---> Using cache
 ---> 2779c490212e
Step 4/12 : RUN npm install
 ---> Using cache
 ---> 46a9bacc8e85
Step 5/12 : COPY frontend/ ./
 ---> Using cache
 ---> 70f9d3b7fd74
Step 6/12 : RUN npm run build
 ---> Using cache
 ---> 165de6881dae
Step 7/12 : FROM nginx:stable-alpine
 ---> c318e336065b
Step 8/12 : RUN rm -f /etc/nginx/conf.d/default.conf || true
 ---> Using cache
 ---> aaaf93d400ca
Step 9/12 : COPY frontend/nginx.conf /etc/nginx/conf.d/default.conf
 ---> Using cache
 ---> 2fad260d14f6
Step 10/12 : COPY --from=build /usr/src/app/dist/angular-15-crud/ /usr/share/nginx/html/
 ---> Using cache
 ---> a05bc0897d45
Step 11/12 : EXPOSE 80
 ---> Using cache
 ---> 88dfd1a9d36a
Step 12/12 : CMD ["nginx", "-g", "daemon off;"]
 ---> Using cache
 ---> 9f2c7c877e03
Successfully built 9f2c7c877e03
Successfully tagged mallikarjuningali/crud-dd-frontend:latest
[Pipeline] sh
+ docker build -t mallikarjuningali/crud-dd-frontend:37 -f Dockerfile.frontend .
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon  59.54MB

Step 1/12 : FROM node:16 AS build
 ---> 1ddc7e4055fd
Step 2/12 : WORKDIR /usr/src/app
 ---> Using cache
 ---> bccdf6f0d1ed
Step 3/12 : COPY frontend/package*.json ./
 ---> Using cache
 ---> 2779c490212e
Step 4/12 : RUN npm install
 ---> Using cache
 ---> 46a9bacc8e85
Step 5/12 : COPY frontend/ ./
 ---> Using cache
 ---> 70f9d3b7fd74
Step 6/12 : RUN npm run build
 ---> Using cache
 ---> 165de6881dae
Step 7/12 : FROM nginx:stable-alpine
 ---> c318e336065b
Step 8/12 : RUN rm -f /etc/nginx/conf.d/default.conf || true
 ---> Using cache
 ---> aaaf93d400ca
Step 9/12 : COPY frontend/nginx.conf /etc/nginx/conf.d/default.conf
 ---> Using cache
 ---> 2fad260d14f6
Step 10/12 : COPY --from=build /usr/src/app/dist/angular-15-crud/ /usr/share/nginx/html/
 ---> Using cache
 ---> a05bc0897d45
Step 11/12 : EXPOSE 80
 ---> Using cache
 ---> 88dfd1a9d36a
Step 12/12 : CMD ["nginx", "-g", "daemon off;"]
 ---> Using cache
 ---> 9f2c7c877e03
Successfully built 9f2c7c877e03
Successfully tagged mallikarjuningali/crud-dd-frontend:37
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Push to Docker Hub)
[Pipeline] withCredentials
Masking supported pattern matches of $DH_PASS
[Pipeline] {
[Pipeline] sh
Warning: A secret was passed to "sh" using Groovy String interpolation, which is insecure.
		 Affected argument(s) used the following variable(s): [DH_PASS]
		 See https://jenkins.io/redirect/groovy-string-interpolation for details.
+ echo ****
+ docker login -u mallikarjuningali --password-stdin

WARNING! Your credentials are stored unencrypted in '/var/lib/jenkins/.docker/config.json'.
Configure a credential helper to remove this warning. See
https://docs.docker.com/go/credential-store/

Login Succeeded
+ docker push mallikarjuningali/crud-dd-backend:latest
The push refers to repository [docker.io/mallikarjuningali/crud-dd-backend]
d243a4f9c01f: Preparing
e4a2b85378be: Preparing
79f369df2602: Preparing
c0edeb7bca42: Preparing
82140d9a70a7: Preparing
f3b40b0cdb1c: Preparing
0b1f26057bd0: Preparing
08000c18d16d: Preparing
f3b40b0cdb1c: Waiting
0b1f26057bd0: Waiting
08000c18d16d: Waiting
e4a2b85378be: Layer already exists
79f369df2602: Layer already exists
c0edeb7bca42: Layer already exists
82140d9a70a7: Layer already exists
0b1f26057bd0: Layer already exists
08000c18d16d: Layer already exists
f3b40b0cdb1c: Layer already exists
d243a4f9c01f: Pushed
latest: digest: sha256:61c8331a632d7213fcf0e8f34eb63909edb8a113d49d206cead860f6edd9ff67 size: 1994
+ docker push mallikarjuningali/crud-dd-backend:37
The push refers to repository [docker.io/mallikarjuningali/crud-dd-backend]
d243a4f9c01f: Preparing
e4a2b85378be: Preparing
79f369df2602: Preparing
c0edeb7bca42: Preparing
82140d9a70a7: Preparing
f3b40b0cdb1c: Preparing
0b1f26057bd0: Preparing
08000c18d16d: Preparing
f3b40b0cdb1c: Waiting
0b1f26057bd0: Waiting
08000c18d16d: Waiting
82140d9a70a7: Layer already exists
e4a2b85378be: Layer already exists
c0edeb7bca42: Layer already exists
79f369df2602: Layer already exists
d243a4f9c01f: Layer already exists
0b1f26057bd0: Layer already exists
f3b40b0cdb1c: Layer already exists
08000c18d16d: Layer already exists
37: digest: sha256:61c8331a632d7213fcf0e8f34eb63909edb8a113d49d206cead860f6edd9ff67 size: 1994
+ docker push mallikarjuningali/crud-dd-frontend:latest
The push refers to repository [docker.io/mallikarjuningali/crud-dd-frontend]
ef418a81cbf7: Preparing
cc0a67e624f1: Preparing
f0186b7a01da: Preparing
90ec27130398: Preparing
a231a657395e: Preparing
5f23a9cf34f1: Preparing
7d9abb9ab3b7: Preparing
34034c523565: Preparing
570a1c87f279: Preparing
412e147b334c: Preparing
922ec217407c: Preparing
5f23a9cf34f1: Waiting
7d9abb9ab3b7: Waiting
34034c523565: Waiting
570a1c87f279: Waiting
412e147b334c: Waiting
922ec217407c: Waiting
a231a657395e: Layer already exists
cc0a67e624f1: Layer already exists
90ec27130398: Layer already exists
f0186b7a01da: Layer already exists
ef418a81cbf7: Layer already exists
5f23a9cf34f1: Layer already exists
34034c523565: Layer already exists
7d9abb9ab3b7: Layer already exists
570a1c87f279: Layer already exists
412e147b334c: Layer already exists
922ec217407c: Layer already exists
latest: digest: sha256:42cb845042942db03c5a7771711cfe99dd25e9a7745630752086d72cd5faa31b size: 2613
+ docker push mallikarjuningali/crud-dd-frontend:37
The push refers to repository [docker.io/mallikarjuningali/crud-dd-frontend]
ef418a81cbf7: Preparing
cc0a67e624f1: Preparing
f0186b7a01da: Preparing
90ec27130398: Preparing
a231a657395e: Preparing
5f23a9cf34f1: Preparing
7d9abb9ab3b7: Preparing
34034c523565: Preparing
570a1c87f279: Preparing
412e147b334c: Preparing
922ec217407c: Preparing
5f23a9cf34f1: Waiting
7d9abb9ab3b7: Waiting
34034c523565: Waiting
570a1c87f279: Waiting
412e147b334c: Waiting
922ec217407c: Waiting
90ec27130398: Layer already exists
ef418a81cbf7: Layer already exists
f0186b7a01da: Layer already exists
a231a657395e: Layer already exists
cc0a67e624f1: Layer already exists
7d9abb9ab3b7: Layer already exists
5f23a9cf34f1: Layer already exists
570a1c87f279: Layer already exists
34034c523565: Layer already exists
412e147b334c: Layer already exists
922ec217407c: Layer already exists
37: digest: sha256:42cb845042942db03c5a7771711cfe99dd25e9a7745630752086d72cd5faa31b size: 2613
+ docker logout
Removing login credentials for https://index.docker.io/v1/
[Pipeline] }
[Pipeline] // withCredentials
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Deploy to VM)
[Pipeline] sshagent
[ssh-agent] Using credentials ubuntu (SSH key for ubuntu@VM)
$ ssh-agent
SSH_AUTH_SOCK=/tmp/ssh-5TOCjNmBM4lg/agent.62570
SSH_AGENT_PID=62573
Running ssh-add (command line suppressed)
Identity added: /var/lib/jenkins/workspace/crud-deploy-pipeline@tmp/private_key_4684714302099466737.key (jenkins-to-vm)
[ssh-agent] Started.
[Pipeline] {
[Pipeline] sh
+ VM_USER=ubuntu
+ VM_HOST=13.203.158.118
+ SSH_PORT=22
+ REMOTE_DIR=/home/ubuntu/crud-deploy
+ ssh -o StrictHostKeyChecking=no -p 22 ubuntu@13.203.158.118 
                            mkdir -p /home/ubuntu/crud-deploy
                        
+ scp -o StrictHostKeyChecking=no -P 22 docker-compose.yml ubuntu@13.203.158.118:/home/ubuntu/crud-deploy/
+ ssh -o StrictHostKeyChecking=no -p 22 ubuntu@13.203.158.118 
                            cd /home/ubuntu/crud-deploy && docker compose pull && docker compose up -d
                        
time="2025-11-30T19:23:51Z" level=warning msg="/home/ubuntu/crud-deploy/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
 mongo Pulling 
 nginx Pulling 
 backend Pulling 
 mongo Pulled 
 nginx Pulled 
 b0dbf0536663 Pulling fs layer 
 b0dbf0536663 Download complete 
 b0dbf0536663 Pull complete 
 backend Pulled 
time="2025-11-30T19:23:59Z" level=warning msg="/home/ubuntu/crud-deploy/docker-compose.yml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
time="2025-11-30T19:23:59Z" level=warning msg="Found orphan containers ([crud_frontend]) for this project. If you removed or renamed this service in your compose file, you can run this command with the --remove-orphans flag to clean it up."
 Container crud_mongo  Running
 Container crud_backend  Recreate
 Container crud_backend  Recreated
 Container crud_nginx  Running
 Container crud_backend  Starting
 Container crud_backend  Started
[Pipeline] }
$ ssh-agent -k
unset SSH_AUTH_SOCK;
unset SSH_AGENT_PID;
echo Agent pid 62573 killed;
[ssh-agent] Stopped.
[Pipeline] // sshagent
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Declarative: Post Actions)
[Pipeline] echo
Pipeline executed successfully!
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline
Finished: SUCCESS
